<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Fully Automated Binance Trading Bot">
    <title>Auto Trading Bot</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        .chart-container {
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Header -->
    <header class="bg-gray-800 text-white py-4">
        <div class="container mx-auto text-center">
            <h1 class="text-3xl font-bold">Auto Trading Bot</h1>
        </div>
    </header>

    <!-- Main Interface -->
    <main class="container mx-auto p-4">
        <!-- Controls -->
        <section class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-2xl font-bold mb-4">Bot Controls</h2>
            <div class="flex gap-4">
                <button id="start-bot" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Start Bot</button>
                <button id="stop-bot" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Stop Bot</button>
            </div>
            <div id="bot-status" class="mt-4">Status: Idle</div>
        </section>

        <!-- Settings -->
        <section class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-bold mb-4">Configuration</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">API Key</label>
                    <input type="text" id="api-key" class="mt-1 block w-full p-2 border rounded-md">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Secret Key</label>
                    <input type="password" id="secret-key" class="mt-1 block w-full p-2 border rounded-md">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Trade Amount ($)</label>
                    <input type="number" id="amount" class="mt-1 block w-full p-2 border rounded-md" value="100">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Trade Limit</label>
                    <input type="number" id="trade-limit" class="mt-1 block w-full p-2 border rounded-md" value="10">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Leverage</label>
                    <input type="number" id="leverage" class="mt-1 block w-full p-2 border rounded-md" value="10">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Time Frame</label>
                    <select id="time-frame" class="mt-1 block w-full p-2 border rounded-md">
                        <option value="1m">1 Minute</option>
                        <option value="5m">5 Minutes</option>
                        <option value="15m">15 Minutes</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Trading Activity -->
        <section class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-bold mb-4">Trading Log</h2>
            <div id="log-entries" class="space-y-2 h-48 overflow-y-auto"></div>
        </section>

        <!-- Price Chart -->
        <section class="bg-white p-6 rounded-lg shadow-md">
            <div class="chart-container">
                <canvas id="price-chart"></canvas>
            </div>
        </section>
    </main>

    <!-- Script -->
    <script>
        // Chart Configuration
        const priceChart = new Chart(document.getElementById('price-chart').getContext('2d'), {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Price',
                    data: [],
                    borderColor: '#4FD1C5',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { display: true, title: { display: true, text: 'Time' }},
                    y: { display: true, title: { display: true, text: 'Price' }}
                }
            }
        });

        // Trading Engine
        let botActive = false;
        let tradeCount = 0; // Track the number of trades executed
        const tradingConfig = {
            leverage: 10,
            amount: 100,
            tradeLimit: 10, // Default trade limit
            strategy: 'MA_CROSS',
            timeframe: '1m'
        };

        // Core Functions
        async function fetchMarketData(symbol, interval, limit = 100) {
            try {
                const response = await fetch(
                    `https://fapi.binance.com/fapi/v1/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`
                );
                return (await response.json()).map(k => parseFloat(k[4]));
            } catch (error) {
                logError(`Data fetch failed: ${error.message}`);
                return [];
            }
        }

        function calculateIndicators(data) {
            const ma10 = [], ma50 = [];
            data.forEach((price, index) => {
                ma10.push(index >= 9 ? 
                    data.slice(index-9, index+1).reduce((a,b) => a+b) / 10 : null);
                ma50.push(index >= 49 ? 
                    data.slice(index-49, index+1).reduce((a,b) => a+b) / 50 : null);
            });
            return { ma10, ma50 };
        }

        async function executeTrade(symbol, action) {
            try {
                const timestamp = Date.now();
                const params = new URLSearchParams({
                    symbol,
                    side: action.toUpperCase(),
                    type: 'MARKET',
                    quantity: tradingConfig.amount,
                    timestamp
                });
                
                const signature = CryptoJS.HmacSHA256(params.toString(), 
                    document.getElementById('secret-key').value).toString(CryptoJS.enc.Hex);

                const response = await fetch(`https://fapi.binance.com/fapi/v1/order?${params}&signature=${signature}`, {
                    method: 'POST',
                    headers: {
                        'X-MBX-APIKEY': document.getElementById('api-key').value,
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                });

                const result = await response.json();
                if(result.status === 'FILLED') {
                    tradeCount++; // Increment trade count
                    logTrade(`${action.toUpperCase()} order executed for ${symbol} (Trade ${tradeCount}/${tradingConfig.tradeLimit})`);
                } else {
                    logError(`Trade failed: ${result.msg}`);
                }
            } catch (error) {
                logError(`Trade execution error: ${error.message}`);
            }
        }

        // Bot Logic
        async function analyzeMarket(symbol) {
            if (tradeCount >= tradingConfig.tradeLimit) {
                logTrade(`Trade limit reached (${tradingConfig.tradeLimit}). Stopping bot.`);
                stopBot();
                return;
            }

            const priceData = await fetchMarketData(symbol, tradingConfig.timeframe);
            if(priceData.length < 50) return;

            const { ma10, ma50 } = calculateIndicators(priceData);
            const currentPrice = priceData[priceData.length - 1];
            
            // Update chart
            priceChart.data.labels = Array.from({length: priceData.length}, (_,i) => i);
            priceChart.data.datasets[0].data = priceData;
            priceChart.update();

            // Trading signals
            if(ma10[ma10.length-1] > ma50[ma50.length-1]) {
                await executeTrade(symbol, 'BUY');
            } else if(ma10[ma10.length-1] < ma50[ma50.length-1]) {
                await executeTrade(symbol, 'SELL');
            }
        }

        async function mainBotLoop() {
            if(!botActive || tradeCount >= tradingConfig.tradeLimit) return;
            
            try {
                const response = await fetch('https://fapi.binance.com/fapi/v1/exchangeInfo');
                const { symbols } = await response.json();
                const perpetualSymbols = symbols.filter(s => s.contractType === 'PERPETUAL');
                
                for(const symbol of perpetualSymbols) {
                    if (!botActive || tradeCount >= tradingConfig.tradeLimit) break;
                    await analyzeMarket(symbol.symbol);
                    await new Promise(resolve => setTimeout(resolve, 1000)); // Rate limit
                }
            } catch (error) {
                logError(`Main loop error: ${error.message}`);
            }
            
            if (botActive && tradeCount < tradingConfig.tradeLimit) {
                setTimeout(mainBotLoop, 60000); // Run every minute
            }
        }

        // Stop Bot Functionality
        function stopBot() {
            botActive = false;
            document.getElementById('bot-status').textContent = 'Status: Idle';
            logTrade('Trading bot stopped.');
        }

        // UI Handlers
        document.getElementById('start-bot').addEventListener('click', () => {
            if(!validateCredentials()) return;
            botActive = true;
            tradeCount = 0; // Reset trade count
            tradingConfig.tradeLimit = parseInt(document.getElementById('trade-limit').value); // Update trade limit
            document.getElementById('bot-status').textContent = 'Status: Active';
            logTrade('Trading bot activated');
            mainBotLoop();
        });

        document.getElementById('stop-bot').addEventListener('click', () => {
            stopBot();
        });

        // Update Trade Limit Dynamically
        document.getElementById('trade-limit').addEventListener('change', (e) => {
            tradingConfig.tradeLimit = parseInt(e.target.value);
            logTrade(`Trade limit updated to ${tradingConfig.tradeLimit}`);
        });

        // Helpers
        function validateCredentials() {
            return document.getElementById('api-key').value && 
                   document.getElementById('secret-key').value;
        }

        function logTrade(message) {
            const logEntry = document.createElement('p');
            logEntry.className = 'text-sm text-gray-700';
            logEntry.innerHTML = `${new Date().toLocaleTimeString()}: ${message}`;
            document.getElementById('log-entries').prepend(logEntry);
        }

        function logError(message) {
            const errorEntry = document.createElement('p');
            errorEntry.className = 'text-sm text-red-500';
            errorEntry.innerHTML = `${new Date().toLocaleTimeString()}: ${message}`;
            document.getElementById('log-entries').prepend(errorEntry);
        }
    </script>
</body>
</html>
